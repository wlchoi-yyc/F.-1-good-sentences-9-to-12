<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>佳句背誦闖關遊戲</title>
<style>
body { font-family: "Noto Sans TC", sans-serif; background: #f0f4f8; margin: 0; padding: 20px; }
h1, h2 { text-align: center; }
.game-btn { display: block; margin: 10px auto; padding: 10px 20px; font-size: 16px; cursor: pointer; }
#game, #result { display: none; text-align: center; }
.sentence-part, .option { display: inline-block; padding: 5px 10px; margin: 5px; border: 1px solid #333; background: #fff; cursor: pointer; }
.dropzone { min-height: 30px; border: 1px dashed #aaa; padding: 10px; margin: 5px; background: #e0e0e0; }
</style>
</head>
<body>

<h1>佳句背誦闖關遊戲</h1>

<div id="menu">
  <p>依次完成四個遊戲，每個遊戲有三關，每關包含所有四句佳句，必須全對才能進入下一關。加油！</p>
  <button class="game-btn" onclick="startGame()">開始遊戲</button>
</div>

<div id="game">
  <h2 id="gameTitle"></h2>
  <div id="score">分數：0</div>
  <div id="gameArea"></div>
  <div id="result"></div>
</div>

<script>
const sentences = [
  "我的心猛然感到一種說不出的惆悵，一股苦澀的味道翻上心頭，就像吞了一口難咽的中藥；串串淚水，像斷了線的珠子，泉湧般順着臉頰滾落下來。",
  "迷茫、彷徨、悵惘的思緒，纏繞着我，使我異常痛苦。我癡呆呆地站着，心裡上上下下地翻滾折騰，五臟六腑都彷彿挪動了位置。",
  "我的鼻子都氣歪了，心裡那股火氣，就像火球一樣在胸膛裡亂滾；又像火山內熾熱的岩漿在湧動，彷彿就要沖決而出了。",
  "我聞訊大吃一驚，猶如晴天響起一聲霹雷，平地卷起一股旋風，倏地打了個寒噤，驚得幾乎躥了起來。一股無名的恐懼，毒蛇的纏在我心上，久久不能擺脫。"
];

let gameIndex = 0; // 0-3
let levelIndex = 0; // 0-2
let score = 0;

function startGame() {
  gameIndex = 0;
  levelIndex = 0;
  score = 0;
  document.getElementById('menu').style.display = 'none';
  document.getElementById('game').style.display = 'block';
  loadLevel();
}

function loadLevel() {
  document.getElementById('result').style.display = 'none';
  document.getElementById('score').textContent = `分數：${score}`;
  let gameTitles = ["佳句接龍", "佳句打地鼠", "佳句填空", "佳句連連看"];
  document.getElementById('gameTitle').textContent = `${gameTitles[gameIndex]} - 第 ${levelIndex + 1} 關`;
  let area = document.getElementById('gameArea');
  area.innerHTML = '';

  let currentSentences = [...sentences];
  let correctCount = 0;

  function finishLevel() {
    if (correctCount === 4) {
      levelIndex++;
      if (levelIndex < 3) {
        document.getElementById('result').innerHTML = `✅ 恭喜過關！<button onclick='loadLevel()'>下一關</button>`;
        document.getElementById('result').style.display = 'block';
      } else {
        gameIndex++;
        levelIndex = 0;
        if (gameIndex < 4) {
          document.getElementById('result').innerHTML = `🎉 遊戲完成！<button onclick='loadLevel()'>進入下一個遊戲</button>`;
          document.getElementById('result').style.display = 'block';
        } else {
          document.getElementById('gameArea').innerHTML = `🎉 恭喜你成功完成！<br>累積分數：${score}<br><button onclick='location.reload()'>重新開始</button>`;
          document.getElementById('gameTitle').textContent = '';
        }
      }
    } else {
      document.getElementById('result').innerHTML = `❌ 有錯誤，請重新挑戰本關！<button onclick='loadLevel()'>重試</button>`;
      document.getElementById('result').style.display = 'block';
    }
  }

  currentSentences.forEach((s, idx) => {
    let p = document.createElement('p');
    p.textContent = `【第${idx + 1}句】`;
    area.appendChild(p);

    if (gameIndex === 0) { // 佳句接龍
      let parts = s.split(/[，；。]/).filter(p => p);
      parts = parts.sort(() => Math.random() - 0.5);
      parts.forEach(part => {
        let span = document.createElement('span');
        span.className = 'sentence-part';
        span.textContent = part;
        span.draggable = true;
        span.ondragstart = e => e.dataTransfer.setData('text/plain', e.target.textContent);
        area.appendChild(span);
      });
      let dz = document.createElement('div');
      dz.className = 'dropzone';
      dz.ondragover = e => e.preventDefault();
      dz.ondrop = e => {
        e.preventDefault();
        let data = e.dataTransfer.getData('text/plain');
        let sp = document.createElement('span');
        sp.textContent = data;
        dz.appendChild(sp);
        let correct = s.split(/[，；。]/).filter(p => p);
        let current = Array.from(dz.children).map(c => c.textContent);
        if (current.join('') === correct.join('')) {
          score += 10;
          correctCount++;
          dz.style.background = '#c8f7c5';
        } else if (current.length === correct.length) {
          dz.style.background = '#f7c5c5';
        }
      };
      area.appendChild(dz);
    } else if (gameIndex === 1) { // 打地鼠
      let parts = s.split(/[，；。]/).filter(p => p);
      let options = parts.concat(["亂入片段", "干擾短語"]);
      options = options.sort(() => Math.random() - 0.5);
      options.forEach(opt => {
        let btn = document.createElement('button');
        btn.className = 'game-btn';
        btn.textContent = opt;
        btn.onclick = () => {
          if (parts.includes(opt)) {
            score += 10;
            correctCount++;
            btn.style.background = '#c8f7c5';
            btn.disabled = true;
          } else {
            score -= 5;
            btn.style.background = '#f7c5c5';
          }
          if (correctCount === 4) finishLevel();
        };
        area.appendChild(btn);
      });
    } else if (gameIndex === 2) { // 填空
      let parts = s.split(/[，；。]/).filter(p => p);
      let missing = parts[1];
      let display = s.replace(missing, '______');
      let displayP = document.createElement('p');
      displayP.textContent = display;
      area.appendChild(displayP);
      let opts = [missing, "亂填短語", "假短語"].sort(() => Math.random() - 0.5);
      opts.forEach(o => {
        let btn = document.createElement('button');
        btn.className = 'game-btn option';
        btn.textContent = o;
        btn.onclick = () => {
          if (o === missing) {
            score += 10;
            correctCount++;
            btn.style.background = '#c8f7c5';
          } else {
            score -= 5;
            btn.style.background = '#f7c5c5';
          }
          if (correctCount === 4) finishLevel();
        };
        area.appendChild(btn);
      });
    } else if (gameIndex === 3) { // 連連看
      let parts = s.split(/[，；。]/).filter(p => p);
      let targets = [...parts].sort(() => Math.random() - 0.5);
      targets.forEach(t => {
        let dz = document.createElement('div');
        dz.className = 'dropzone';
        dz.textContent = '放置短語';
        dz.ondragover = e => e.preventDefault();
        dz.ondrop = e => {
          e.preventDefault();
          let data = e.dataTransfer.getData('text/plain');
          if (data === t) {
            dz.textContent = data;
            dz.style.background = '#c8f7c5';
            score += 10;
            correctCount++;
          } else {
            score -= 5;
            dz.style.background = '#f7c5c5';
          }
          if (correctCount === 4) finishLevel();
        };
        area.appendChild(dz);
      });
      parts.forEach(p => {
        let span = document.createElement('span');
        span.className = 'sentence-part';
        span.textContent = p;
        span.draggable = true;
        span.ondragstart = e => e.dataTransfer.setData('text/plain', p);
        area.appendChild(span);
      });
    }
  });
}
</script>
</body>
</html>
