<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>ä½³å¥èƒŒèª¦é—–é—œéŠæˆ²</title>
<style>
  body { font-family: "Noto Sans TC", sans-serif; background: #f0f4f8; margin: 0; padding: 20px; }
  h1, h2 { text-align: center; }
  .game-btn { display: block; margin: 10px auto; padding: 10px 20px; font-size: 16px; cursor: pointer; }
  #game, #result { display: none; text-align: center; }
  .sentence-part, .option { display: inline-block; padding: 5px 10px; margin: 5px; border: 1px solid #333; background: #fff; cursor: pointer; }
  .dropzone { min-height: 30px; border: 1px dashed #aaa; padding: 10px; margin: 5px; background: #e0e0e0; }
  .disabled { pointer-events: none; opacity: 0.6; }
</style>
</head>
<body>

<h1>ä½³å¥èƒŒèª¦é—–é—œéŠæˆ²</h1>

<div id="menu">
  <p>ä¾æ¬¡å®Œæˆå››å€‹éŠæˆ²ï¼Œæ¯å€‹éŠæˆ²æœ‰ä¸‰é—œï¼Œæ¯é—œåŒ…å«æ‰€æœ‰å››å¥ä½³å¥ï¼Œå¿…é ˆå…¨å°æ‰èƒ½é€²å…¥ä¸‹ä¸€é—œã€‚åŠ æ²¹ï¼</p>
  <button class="game-btn" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
</div>

<div id="game">
  <h2 id="gameTitle"></h2>
  <div id="score">åˆ†æ•¸ï¼š0</div>
  <div id="gameArea"></div>
  <div id="result"></div>
</div>

<script>
const sentences = [
  "æˆ‘çš„å¿ƒçŒ›ç„¶æ„Ÿåˆ°ä¸€ç¨®èªªä¸å‡ºçš„æƒ†æ‚µï¼Œä¸€è‚¡è‹¦æ¾€çš„å‘³é“ç¿»ä¸Šå¿ƒé ­ï¼Œå°±åƒåäº†ä¸€å£é›£å’½çš„ä¸­è—¥ï¼›ä¸²ä¸²æ·šæ°´ï¼Œåƒæ–·äº†ç·šçš„ç å­ï¼Œæ³‰æ¹§èˆ¬é †ç€è‡‰é °æ»¾è½ä¸‹ä¾†ã€‚",
  "è¿·èŒ«ã€å½·å¾¨ã€æ‚µæƒ˜çš„æ€ç·’ï¼Œçºç¹ç€æˆ‘ï¼Œä½¿æˆ‘ç•°å¸¸ç—›è‹¦ã€‚æˆ‘ç™¡å‘†å‘†åœ°ç«™ç€ï¼Œå¿ƒè£¡ä¸Šä¸Šä¸‹ä¸‹åœ°ç¿»æ»¾æŠ˜é¨°ï¼Œäº”è‡Ÿå…­è…‘éƒ½å½·å½¿æŒªå‹•äº†ä½ç½®ã€‚",
  "æˆ‘çš„é¼»å­éƒ½æ°£æ­ªäº†ï¼Œå¿ƒè£¡é‚£è‚¡ç«æ°£ï¼Œå°±åƒç«çƒä¸€æ¨£åœ¨èƒ¸è†›è£¡äº‚æ»¾ï¼›åˆåƒç«å±±å…§ç†¾ç†±çš„å²©æ¼¿åœ¨æ¹§å‹•ï¼Œå½·å½¿å°±è¦æ²–æ±ºè€Œå‡ºäº†ã€‚",
  "æˆ‘èè¨Šå¤§åƒä¸€é©šï¼ŒçŒ¶å¦‚æ™´å¤©éŸ¿èµ·ä¸€è²éœ¹é›·ï¼Œå¹³åœ°å·èµ·ä¸€è‚¡æ—‹é¢¨ï¼Œå€åœ°æ‰“äº†å€‹å¯’å™¤ï¼Œé©šå¾—å¹¾ä¹èº¥äº†èµ·ä¾†ã€‚ä¸€è‚¡ç„¡åçš„ææ‡¼ï¼Œæ¯’è›‡çš„çºåœ¨æˆ‘å¿ƒä¸Šï¼Œä¹…ä¹…ä¸èƒ½æ“ºè„«ã€‚"
];

let gameIndex = 0; // 0-3
let levelIndex = 0; // 0-2
let score = 0;

function updateScoreDisplay() {
  document.getElementById('score').textContent = `åˆ†æ•¸ï¼š${score}`;
}

function startGame() {
  gameIndex = 0;
  levelIndex = 0;
  score = 0;
  updateScoreDisplay();
  document.getElementById('menu').style.display = 'none';
  document.getElementById('game').style.display = 'block';
  loadLevel();
}

function loadLevel() {
  document.getElementById('result').style.display = 'none';
  updateScoreDisplay();

  const gameTitles = ["ä½³å¥æ¥é¾", "ä½³å¥æ‰“åœ°é¼ ", "ä½³å¥å¡«ç©º", "ä½³å¥é€£é€£çœ‹"];
  document.getElementById('gameTitle').textContent = `${gameTitles[gameIndex]} - ç¬¬ ${levelIndex + 1} é—œ`;

  const area = document.getElementById('gameArea');
  area.innerHTML = '';
  let correctCount = 0;

  function finishLevel() {
    if (correctCount === 4) {
      levelIndex++;
      if (levelIndex < 3) {
        document.getElementById('result').innerHTML = `âœ… æ­å–œéé—œï¼<button onclick='loadLevel()'>ä¸‹ä¸€é—œ</button>`;
        document.getElementById('result').style.display = 'block';
      } else {
        gameIndex++;
        levelIndex = 0;
        if (gameIndex < 4) {
          document.getElementById('result').innerHTML = `ğŸ‰ éŠæˆ²å®Œæˆï¼<button onclick='loadLevel()'>é€²å…¥ä¸‹ä¸€å€‹éŠæˆ²</button>`;
          document.getElementById('result').style.display = 'block';
        } else {
          document.getElementById('gameArea').innerHTML = `ğŸ‰ æ­å–œä½ æˆåŠŸå®Œæˆï¼<br>ç´¯ç©åˆ†æ•¸ï¼š${score}<br><button onclick='location.reload()'>é‡æ–°é–‹å§‹</button>`;
          document.getElementById('gameTitle').textContent = '';
        }
      }
    } else {
      document.getElementById('result').innerHTML = `âŒ æœ‰éŒ¯èª¤ï¼Œè«‹é‡æ–°æŒ‘æˆ°æœ¬é—œï¼<button onclick='loadLevel()'>é‡è©¦</button>`;
      document.getElementById('result').style.display = 'block';
    }
  }

  sentences.forEach((s, idx) => {
    const sentenceWrapper = document.createElement('div');
    sentenceWrapper.style.marginBottom = '20px';
    area.appendChild(sentenceWrapper);

    const p = document.createElement('p');
    p.textContent = `ã€ç¬¬${idx + 1}å¥ã€‘`;
    sentenceWrapper.appendChild(p);

    const correctParts = s.split(/[ï¼Œï¼›ã€‚]/).filter(p => p);
    if (gameIndex === 0) {
      // ä½³å¥æ¥é¾ï¼šå¿…é ˆæŒ‰æ­£ç¢ºé †åºæ”¾å…¥
      let shuffledParts = [...correctParts].sort(() => Math.random() - 0.5);
      let placedCount = 0;
      let sentenceDone = false;

      // é¡¯ç¤ºå¯æ‹–æ›³çš„çŸ­èª
      shuffledParts.forEach(part => {
        const span = document.createElement('span');
        span.className = 'sentence-part';
        span.textContent = part;
        span.draggable = true;
        span.ondragstart = e => e.dataTransfer.setData('text/plain', e.target.textContent);
        sentenceWrapper.appendChild(span);
      });

      // å»ºç«‹ dropzone
      const dz = document.createElement('div');
      dz.className = 'dropzone';
      dz.ondragover = e => e.preventDefault();
      dz.ondrop = e => {
        e.preventDefault();
        if (sentenceDone) return; // å·²ç¶“éé—œï¼Œä¸å†æ¥å—æ–°çš„æ‹–æ”¾
        const data = e.dataTransfer.getData('text/plain');
        if (data === correctParts[placedCount]) {
          const sp = document.createElement('span');
          sp.textContent = data;
          dz.appendChild(sp);
          placedCount++;
          if (placedCount === correctParts.length) {
            // æœ¬å¥éé—œ
            sentenceDone = true;
            dz.style.background = '#c8f7c5';
            score += 10;
            updateScoreDisplay();
            correctCount++;
            finishLevelIfNeeded();
          } else {
            // æ­£ç¢ºæ”¾ä¸‹ä¸€æ®µï¼Œæš«æ™‚ä¸æ”¹è®ŠèƒŒæ™¯ï¼Œç­‰å¾…æ”¾æ»¿
            dz.style.background = '#e0e0e0';
          }
        } else {
          // æ”¾éŒ¯ï¼Œé–ƒç´…ä¸¦æ‰£åˆ†
          dz.style.background = '#f7c5c5';
          score -= 5;
          updateScoreDisplay();
          setTimeout(() => {
            if (!sentenceDone) dz.style.background = '#e0e0e0';
          }, 500);
        }
      };
      sentenceWrapper.appendChild(dz);

      function finishLevelIfNeeded() {
        if (correctCount === 4) finishLevel();
      }

    } else if (gameIndex === 1) {
      // ä½³å¥æ‰“åœ°é¼ ï¼šéœ€é‡å°æ¯å¥é»æ“Š 1 æ®µæ‰ç®—è©²å¥ç­”å°
      const parts = correctParts.map(text => ({ text, sentenceIdx: idx }));
      let answered = false;

      // å»ºç«‹ 4 å€‹é¸é …ï¼šæ­£ç¢ºçŸ­èª + 3 å€‹å¹²æ“¾ï¼ˆå…¶ä¸­å…©å€‹æ˜¯å›ºå®šæ–‡å­—ï¼Œç¢ºä¿ 4 å€‹æŒ‰éˆ•ï¼‰
      let options = [...parts.map(pObj => pObj.text), "äº‚å…¥ç‰‡æ®µ", "å‡çŸ­èª", "å¹²æ“¾çŸ­èª"];
      options = options.sort(() => Math.random() - 0.5);

      options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'game-btn';
        btn.textContent = opt;
        btn.onclick = () => {
          if (answered) return;
          if (parts.some(pObj => pObj.text === opt)) {
            // å¦‚æœè©²å¥é‚„æ²’ç­”éï¼Œå°±ç®—é€™å¥ç­”å°
            answered = true;
            btn.style.background = '#c8f7c5';
            score += 10;
            updateScoreDisplay();
            correctCount++;
            finishLevelIfNeeded();
          } else {
            btn.style.background = '#f7c5c5';
            score -= 5;
            updateScoreDisplay();
          }
          btn.disabled = true;
        };
        sentenceWrapper.appendChild(btn);
      });

      function finishLevelIfNeeded() {
        if (correctCount === 4) finishLevel();
      }

    } else if (gameIndex === 2) {
      // ä½³å¥å¡«ç©ºï¼šæ¯å¥å›ºå®šæŠ½ä¸€æ®µåšç­”æ¡ˆ
      const parts = correctParts;
      // éš¨æ©Ÿé¸ä¸€æ®µç•¶å¡«ç©ºç­”æ¡ˆï¼ˆæˆ–æŒ‰ levelIndex å–ï¼Œå¯è‡ªè¡Œèª¿æ•´ï¼‰
      const answerIdx = levelIndex % parts.length;
      const missing = parts[answerIdx];
      const display = s.replace(missing, '______');

      const displayP = document.createElement('p');
      displayP.textContent = display;
      sentenceWrapper.appendChild(displayP);

      let opts = [missing, "äº‚å¡«çŸ­èª", "å‡çŸ­èª"].sort(() => Math.random() - 0.5);
      opts.forEach(o => {
        const btn = document.createElement('button');
        btn.className = 'game-btn option';
        btn.textContent = o;
        btn.onclick = () => {
          if (btn.classList.contains('disabled')) return;
          btn.classList.add('disabled');
          if (o === missing) {
            btn.style.background = '#c8f7c5';
            score += 10;
            correctCount++;
          } else {
            btn.style.background = '#f7c5c5';
            score -= 5;
          }
          updateScoreDisplay();
          if (correctCount === 4) finishLevel();
        };
        sentenceWrapper.appendChild(btn);
      });

    } else if (gameIndex === 3) {
      // ä½³å¥é€£é€£çœ‹ï¼šæŠŠæ¯å¥å”¯ä¸€ä¸€æ®µæ”¾åˆ°å°æ‡‰ dropzone
      const parts = correctParts;
      // å»ºç«‹ 1 å€‹ dropzone å°æ‡‰é€™ä¸€å¥
      let sentenceDone = false;
      const target = parts[0]; // å›ºå®šç”¨ç¬¬ä¸€æ®µä½œåŒ¹é…ï¼Œä¹Ÿå¯ä»¥éš¨æ©Ÿ
      const dz = document.createElement('div');
      dz.className = 'dropzone';
      dz.textContent = 'æ”¾ç½®çŸ­èª';
      dz.ondragover = e => e.preventDefault();
      dz.ondrop = e => {
        e.preventDefault();
        if (sentenceDone) return;
        const data = e.dataTransfer.getData('text/plain');
        if (data === target) {
          dz.textContent = data;
          dz.style.background = '#c8f7c5';
          sentenceDone = true;
          score += 10;
          updateScoreDisplay();
          correctCount++;
          finishLevelIfNeeded();
        } else {
          dz.style.background = '#f7c5c5';
          score -= 5;
          updateScoreDisplay();
          setTimeout(() => {
            if (!sentenceDone) {
              dz.textContent = 'æ”¾ç½®çŸ­èª';
              dz.style.background = '#e0e0e0';
            }
          }, 500);
        }
      };
      sentenceWrapper.appendChild(dz);

      // é¡¯ç¤ºå¯æ‹–æ›³çš„çŸ­èªï¼šåƒ…å‡ºç¾æ‰€æœ‰æ­£ç¢ºçŸ­èª
      parts.forEach(p => {
        const span = document.createElement('span');
        span.className = 'sentence-part';
        span.textContent = p;
        span.draggable = true;
        span.ondragstart = e => e.dataTransfer.setData('text/plain', p);
        sentenceWrapper.appendChild(span);
      });

      function finishLevelIfNeeded() {
        if (correctCount === 4) finishLevel();
      }
    }
  });
}
</script>
</body>
</html>
